{% extends "templates/web.html" %}

{% block title %}Salary Slip Dashboard{% endblock %}

{% block head_include %}
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'DM Sans', sans-serif; }
  .dash-wrapper { background: #f4f6f9; min-height: 100vh; padding: 28px 24px; }

  .dash-header { margin-bottom: 20px; }
  .dash-header h1 { font-size: 20px; font-weight: 700; color: #1a2035; margin-bottom: 4px; }
  .dash-header p  { font-size: 13px; color: #6b7280; }

  /* Filter Bar */
  .filter-bar {
    background: #fff; border: 1px solid #e4e7ec; border-radius: 10px;
    padding: 16px 20px; display: flex; align-items: flex-end;
    gap: 16px; flex-wrap: wrap; margin-bottom: 20px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }
  .filter-group { display: flex; flex-direction: column; gap: 5px; flex: 1; min-width: 180px; }
  .filter-group label { font-size: 11px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; }
  .filter-group select {
    padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 7px;
    font-size: 13px; font-family: 'DM Sans', sans-serif;
    color: #1a2035; background: #f9fafb; cursor: pointer; outline: none;
  }
  .filter-group select:focus { border-color: #2563eb; background: #fff; }
  .btn-apply {
    padding: 9px 24px; background: #2563eb; color: #fff; border: none;
    border-radius: 7px; font-size: 13px; font-weight: 600;
    font-family: 'DM Sans', sans-serif; cursor: pointer; height: 38px;
  }
  .btn-apply:hover { background: #1d4ed8; }


  /* Chart Card */
  .chart-card {
    background: #fff; border: 1px solid #e4e7ec; border-radius: 10px;
    padding: 24px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }
  .chart-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
  .chart-title    { font-size: 15px; font-weight: 600; color: #1a2035; margin-bottom: 3px; }
  .chart-subtitle { font-size: 12px; color: #9ca3af; }
  .chart-legend   { display: flex; gap: 20px; align-items: center; }
  .legend-item    { display: flex; align-items: center; gap: 7px; font-size: 12px; color: #374151; font-weight: 500; }
  .legend-dot     { width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0; }

  .chart-container { position: relative; height: 360px; }

  #chart-placeholder {
    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    color: #9ca3af; font-size: 14px; gap: 10px;
  }
  .state-icon { font-size: 36px; }
  .loading-spinner {
    width: 22px; height: 22px; border: 2px solid #e4e7ec;
    border-top-color: #2563eb; border-radius: 50%;
    animation: spin 0.7s linear infinite; display: inline-block;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  @media (max-width: 640px) {
    .filter-bar   { flex-direction: column; }
    .chart-header { flex-direction: column; gap: 10px; }
    .top-card-value { font-size: 28px; }
  }
  /* Hide scrollbar */
  body { overflow: hidden; }
  html { overflow: hidden; }

  /* Hide Built on Frappe footer */
  footer, .web-footer, [class*="footer"], .built-with { display: none !important; }

</style>
{% endblock %}

{% block page_content %}
<div class="dash-wrapper">

  <!-- Header -->
  <div class="dash-header">
    <h1>ðŸ“Š Salary Slip Dashboard</h1>
    <p>Company wise monthly salary slip status â€” Generated vs Pending</p>
  </div>

  <!-- Filter Bar -->
  <div class="filter-bar">
    <div class="filter-group">
      <label>Company</label>
      <select id="company-select">
        <option value="">â€” Select Company â€”</option>
        {% for c in companies %}
        <option value="{{ c.name }}">{{ c.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="filter-group">
      <label>Year</label>
      <select id="year-select">
        {% for y in years %}
        <option value="{{ y }}" {% if y == current_year %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>
    </div>
    <button class="btn-apply" onclick="loadDashboard()">Apply Filter</button>
  </div>

  <!-- Double Bar Chart -->
  <div class="chart-card">
    <div class="chart-header">
      <div>
        <div class="chart-title">Monthly Salary Slip Status</div>
        <div class="chart-subtitle" id="chart-subtitle">Select company and year to load chart</div>
      </div>
    </div>
    <div class="chart-container">
      <canvas id="salaryChart"></canvas>
      <div id="chart-placeholder">
        <span class="state-icon">ðŸ“‚</span>
        <span>Select company and year â†’ click <strong>Apply Filter</strong></span>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block script %}
<script src="{{ url_prefix }}/Salary_dashboard/index.js"></script>
{% endblock %}